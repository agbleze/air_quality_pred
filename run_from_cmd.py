
import subprocess

res= subprocess.check_output(["./lightgbm", 
                # "config=/home/lin/lightgbm_gpu.conf",
                "max_bin=63","num_leaves=255",
                "num_iterations = 50", "learning_rate = 0.1",
                "tree_learner = serial", "task = train",
                "is_training_metric = false",
                "min_data_in_leaf = 1", 
                "min_sum_hessian_in_leaf = 100",
                "ndcg_eval_at = 1,3,5,10",
                "device = cuda", "num_threads=20",
                "convert_model_language=cpp",
                 "data=/home/lin/higgs.train",
                 "valid=/home/lin/higgs.test",
                 "gpu_platform_id = 0",
                 "objective=binary",
                 "metric=auc"
                 ])

#print(res.rstrip())


#%%
#egoutput = b'[LightGBM] [Info] Finished loading parameters\n[LightGBM] [Warning] Using sparse features with CUDA is currently not supported.\n[LightGBM] [Info] Construct bin mappers from text data time 0.60 seconds\n[LightGBM] [Warning] Metric auc is not implemented in cuda version. Fall back to evaluation on CPU.\n[LightGBM] [Info] Finished loading data in 7.953604 seconds\n[LightGBM] [Info] Number of positive: 5564616, number of negative: 4935384\n[LightGBM] [Info] Total Bins 1524\n[LightGBM] [Info] Number of data points in the train set: 10500000, number of used features: 28\n[LightGBM] [Info] Finished initializing training\n[LightGBM] [Info] Started training...\n[LightGBM] [Info] [binary:BoostFromScore]: pavg=0.529963 -> initscore=0.119997\n[LightGBM] [Info] Start training from score 0.119997\n[LightGBM] [Info] Iteration:1, valid_1 auc : 0.771835\n[LightGBM] [Info] 0.184250 seconds elapsed, finished iteration 1\n[LightGBM] [Info] Iteration:2, valid_1 auc : 0.778339\n[LightGBM] [Info] 0.359602 seconds elapsed, finished iteration 2\n[LightGBM] [Info] Iteration:3, valid_1 auc : 0.781228\n[LightGBM] [Info] 0.558983 seconds elapsed, finished iteration 3\n[LightGBM] [Info] Iteration:4, valid_1 auc : 0.783745\n[LightGBM] [Info] 0.707892 seconds elapsed, finished iteration 4\n[LightGBM] [Info] Iteration:5, valid_1 auc : 0.786385\n[LightGBM] [Info] 0.861660 seconds elapsed, finished iteration 5\n[LightGBM] [Info] Iteration:6, valid_1 auc : 0.787995\n[LightGBM] [Info] 1.023971 seconds elapsed, finished iteration 6\n[LightGBM] [Info] Iteration:7, valid_1 auc : 0.789627\n[LightGBM] [Info] 1.202551 seconds elapsed, finished iteration 7\n[LightGBM] [Info] Iteration:8, valid_1 auc : 0.791183\n[LightGBM] [Info] 1.369660 seconds elapsed, finished iteration 8\n[LightGBM] [Info] Iteration:9, valid_1 auc : 0.792727\n[LightGBM] [Info] 1.519339 seconds elapsed, finished iteration 9\n[LightGBM] [Info] Iteration:10, valid_1 auc : 0.794131\n[LightGBM] [Info] 1.679229 seconds elapsed, finished iteration 10\n[LightGBM] [Info] Iteration:11, valid_1 auc : 0.795505\n[LightGBM] [Info] 1.859134 seconds elapsed, finished iteration 11\n[LightGBM] [Info] Iteration:12, valid_1 auc : 0.79664\n[LightGBM] [Info] 2.111572 seconds elapsed, finished iteration 12\n[LightGBM] [Info] Iteration:13, valid_1 auc : 0.797967\n[LightGBM] [Info] 2.267165 seconds elapsed, finished iteration 13\n[LightGBM] [Info] Iteration:14, valid_1 auc : 0.799067\n[LightGBM] [Info] 2.433516 seconds elapsed, finished iteration 14\n[LightGBM] [Info] Iteration:15, valid_1 auc : 0.800821\n[LightGBM] [Info] 2.606518 seconds elapsed, finished iteration 15\n[LightGBM] [Info] Iteration:16, valid_1 auc : 0.801777\n[LightGBM] [Info] 2.765907 seconds elapsed, finished iteration 16\n[LightGBM] [Info] Iteration:17, valid_1 auc : 0.802916\n[LightGBM] [Info] 2.908901 seconds elapsed, finished iteration 17\n[LightGBM] [Info] Iteration:18, valid_1 auc : 0.803837\n[LightGBM] [Info] 3.073549 seconds elapsed, finished iteration 18\n[LightGBM] [Info] Iteration:19, valid_1 auc : 0.804934\n[LightGBM] [Info] 3.219513 seconds elapsed, finished iteration 19\n[LightGBM] [Info] Iteration:20, valid_1 auc : 0.805733\n[LightGBM] [Info] 3.392590 seconds elapsed, finished iteration 20\n[LightGBM] [Info] Iteration:21, valid_1 auc : 0.806726\n[LightGBM] [Info] 3.588942 seconds elapsed, finished iteration 21\n[LightGBM] [Info] Iteration:22, valid_1 auc : 0.807533\n[LightGBM] [Info] 3.772316 seconds elapsed, finished iteration 22\n[LightGBM] [Info] Iteration:23, valid_1 auc : 0.808295\n[LightGBM] [Info] 3.934672 seconds elapsed, finished iteration 23\n[LightGBM] [Info] Iteration:24, valid_1 auc : 0.809225\n[LightGBM] [Info] 4.103556 seconds elapsed, finished iteration 24\n[LightGBM] [Info] Iteration:25, valid_1 auc : 0.809843\n[LightGBM] [Info] 4.302463 seconds elapsed, finished iteration 25\n[LightGBM] [Info] Iteration:26, valid_1 auc : 0.810604\n[LightGBM] [Info] 4.473421 seconds elapsed, finished iteration 26\n[LightGBM] [Info] Iteration:27, valid_1 auc : 0.811235\n[LightGBM] [Info] 4.680212 seconds elapsed, finished iteration 27\n[LightGBM] [Info] Iteration:28, valid_1 auc : 0.811824\n[LightGBM] [Info] 4.849564 seconds elapsed, finished iteration 28\n[LightGBM] [Info] Iteration:29, valid_1 auc : 0.812494\n[LightGBM] [Info] 4.987879 seconds elapsed, finished iteration 29\n[LightGBM] [Info] Iteration:30, valid_1 auc : 0.81307\n[LightGBM] [Info] 5.143556 seconds elapsed, finished iteration 30\n[LightGBM] [Info] Iteration:31, valid_1 auc : 0.813657\n[LightGBM] [Info] 5.297795 seconds elapsed, finished iteration 31\n[LightGBM] [Info] Iteration:32, valid_1 auc : 0.814262\n[LightGBM] [Info] 5.442129 seconds elapsed, finished iteration 32\n[LightGBM] [Info] Iteration:33, valid_1 auc : 0.814724\n[LightGBM] [Info] 5.613432 seconds elapsed, finished iteration 33\n[LightGBM] [Info] Iteration:34, valid_1 auc : 0.815175\n[LightGBM] [Info] 5.777910 seconds elapsed, finished iteration 34\n[LightGBM] [Info] Iteration:35, valid_1 auc : 0.815625\n[LightGBM] [Info] 5.966608 seconds elapsed, finished iteration 35\n[LightGBM] [Info] Iteration:36, valid_1 auc : 0.816063\n[LightGBM] [Info] 6.134564 seconds elapsed, finished iteration 36\n[LightGBM] [Info] Iteration:37, valid_1 auc : 0.816476\n[LightGBM] [Info] 6.281741 seconds elapsed, finished iteration 37\n[LightGBM] [Info] Iteration:38, valid_1 auc : 0.816919\n[LightGBM] [Info] 6.446711 seconds elapsed, finished iteration 38\n[LightGBM] [Info] Iteration:39, valid_1 auc : 0.817325\n[LightGBM] [Info] 6.645830 seconds elapsed, finished iteration 39\n[LightGBM] [Info] Iteration:40, valid_1 auc : 0.817732\n[LightGBM] [Info] 6.863530 seconds elapsed, finished iteration 40\n[LightGBM] [Info] Iteration:41, valid_1 auc : 0.818117\n[LightGBM] [Info] 7.024245 seconds elapsed, finished iteration 41\n[LightGBM] [Info] Iteration:42, valid_1 auc : 0.818484\n[LightGBM] [Info] 7.182456 seconds elapsed, finished iteration 42\n[LightGBM] [Info] Iteration:43, valid_1 auc : 0.818831\n[LightGBM] [Info] 7.362253 seconds elapsed, finished iteration 43\n[LightGBM] [Info] Iteration:44, valid_1 auc : 0.819217\n[LightGBM] [Info] 7.523567 seconds elapsed, finished iteration 44\n[LightGBM] [Info] Iteration:45, valid_1 auc : 0.81956\n[LightGBM] [Info] 7.696196 seconds elapsed, finished iteration 45\n[LightGBM] [Info] Iteration:46, valid_1 auc : 0.819865\n[LightGBM] [Info] 7.897500 seconds elapsed, finished iteration 46\n[LightGBM] [Info] Iteration:47, valid_1 auc : 0.82025\n[LightGBM] [Info] 8.057357 seconds elapsed, finished iteration 47\n[LightGBM] [Info] Iteration:48, valid_1 auc : 0.820665\n[LightGBM] [Info] 8.238172 seconds elapsed, finished iteration 48\n[LightGBM] [Info] Iteration:49, valid_1 auc : 0.820917\n[LightGBM] [Info] 8.391436 seconds elapsed, finished iteration 49\n[LightGBM] [Info] Iteration:50, valid_1 auc : 0.821268\n[LightGBM] [Info] 8.552252 seconds elapsed, finished iteration 50\n[LightGBM] [Info] Finished training'
# %%
import numpy as np
output = np.float32(res.decode().split("auc")[-1].split("\n")[0].split(":")[-1].split(" ")[-1])
print(f"eval: {output}")

# %%
